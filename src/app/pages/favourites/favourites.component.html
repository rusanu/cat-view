<app-action-bar (refresh)="refreshFavourites()"></app-action-bar>

<!-- View switcher -->
<div class="view-switcher mx-3 mb-2">
  <button class="btn btn-sm btn-outline-secondary" (click)="navigateToPhotos()">
    <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" viewBox="0 0 16 16">
      <path d="M4.715 6.542 3.343 7.914a3 3 0 1 0 4.243 4.243l1.828-1.829A3 3 0 0 0 8.586 5.5L8 6.086a1.002 1.002 0 0 0-.154.199 2 2 0 0 1 .861 3.337L6.88 11.45a2 2 0 1 1-2.83-2.83l.793-.792a4.018 4.018 0 0 1-.128-1.287z"/>
      <path d="M6.586 4.672A3 3 0 0 0 7.414 9.5l.775-.776a2 2 0 0 1-.896-3.346L9.12 3.55a2 2 0 1 1 2.83 2.83l-.793.792c.112.42.155.855.128 1.287l1.372-1.372a3 3 0 1 0-4.243-4.243L6.586 4.672z"/>
    </svg>
    Înapoi la Pozele Normale
  </button>
  <span class="badge bg-primary ms-2">{{ photos.length }} poze favorite</span>
</div>

<!-- Error Banner -->
<div *ngIf="error && !loading" class="alert alert-info alert-dismissible fade show mx-3" role="alert">
  <p class="mb-0">{{ error }}</p>
  <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close" (click)="dismissError()"></button>
</div>

<div class="photos-container">
  <!-- Loading State -->
  <div *ngIf="loading" class="text-center py-5">
    <div class="spinner-border" role="status">
      <span class="visually-hidden">Se încarcă...</span>
    </div>
    <p class="mt-2">Se încarcă pozele favorite...</p>
  </div>

  <!-- No Favourites Found -->
  <div *ngIf="!loading && photos.length === 0" class="alert alert-info mx-3">
    <h5>Nu Ai Poze Favorite</h5>
    <p>Nu ai nicio poză marcată ca favorită încă. Adaugă poze la favorite din vizualizarea principală.</p>
    <button class="btn btn-primary mt-2" (click)="navigateToPhotos()">Mergi la Pozele Normale</button>
  </div>

  <!-- Split Panel Layout -->
  <div *ngIf="!loading && photos.length > 0" class="split-panel">
    <!-- Left Panel: Photo List (Thumbnails) -->
    <div *ngIf="(config.showGrid$ | async)" class="photo-list-panel" [style.width.px]="leftPanelWidth">
      <app-photo-list class="photo-list-container"
        [photos]="photos"
        [selectedPhoto]="selectedPhoto"
        [showFavourites]="false"
        (photoSelected)="onPhotoSelected($event)">
      </app-photo-list>
    </div>

    <!-- Draggable Divider -->
    <div class="panel-divider"
         (mousedown)="onDividerMouseDown($event)"
         title="Drag to resize">
      <div class="divider-handle"></div>
    </div>

    <!-- Right Panel: Photo Viewer + Graphs -->
    <div class="photo-viewer-panel">
      <div class="viewer-content" [class.with-graphs]="showGraphs">
        <div class="photo-section" [class.split]="showGraphs"
             [style.height.%]="showGraphs ? photoSectionHeight : 100">
          <app-photo-viewer
            [style.height.%]="100"
            [photo]="selectedPhoto"
            (nextPhoto)="nextPhoto()"
            (prevPhoto)="previousPhoto()">
          </app-photo-viewer>
        </div>

        <!-- Vertical Divider (only when graphs shown) -->
        <div *ngIf="showGraphs" class="vertical-divider"
             (mousedown)="onVerticalDividerMouseDown($event)"
             title="Drag to resize">
          <div class="vertical-divider-handle"></div>
        </div>

        <div *ngIf="showGraphs" class="graphs-section"
             [style.height.%]="100 - photoSectionHeight">
          <app-photo-graphs
            [photos]="photos">
          </app-photo-graphs>
        </div>
      </div>
    </div>
  </div>
</div>
